# 勞報單系統 Labor Report System

智慧媽咪國際 / 薇佳工作室 勞務報酬單管理系統

參考：直誠會計事務所 雲端秘書

---

## 📋 系統簡介

一套簡單易用的勞務報酬單管理系統，讓你：
- **後台**：輸入金額 → 自動算稅 → 產生連結
- **對方**：開連結 → 填資料 → 上傳證件 → 簽名
- **會計**：批次匯出 Excel 報稅

### 公司資料

| 公司名稱 | 統一編號 | 負責人 |
|---------|---------|-------|
| 智慧媽咪國際股份有限公司 | 95493378 | 林央珽 |
| 薇佳工作室 | 88535681 | 林央珽 |

---

## ✨ 功能特色

### 🖥️ 後台管理（員工操作）

| 功能 | 說明 |
|-----|------|
| 公司切換 | 左上角可切換智慧媽咪 / 薇佳工作室 |
| 新增勞報單 | 填寫：領款人姓名、金額、所得類別、服務期間、支付日期 |
| 自動計算 | 系統即時計算代扣所得稅、二代健保補充保費 |
| 產生連結 | 一鍵產生簽名連結，複製發送給領款人 |
| 勞報單列表 | 查看所有勞報單狀態（草稿/待簽名/已簽名）|
| 聯絡人管理 | 管理常用領款人資料 |
| 批次匯出 | 勾選多筆已簽名勞報單 → 匯出 Excel 給會計師 |
| PDF 下載 | 下載單筆勞報單 PDF |

### 📱 外部簽名頁（領款人操作，免登入）

| 功能 | 說明 |
|-----|------|
| 查看勞報單 | 顯示金額明細、代扣稅額、實付金額 |
| 填寫資料 | 姓名、身分證、電話、Email、戶籍地址 |
| 銀行資料 | 銀行名稱、分行、帳號 |
| 上傳證件 | 身分證正面、身分證反面、銀行存摺封面（支援拍照）|
| 手動簽名 | 觸控螢幕或滑鼠簽名 |
| ⭐ 自動帶出 | 輸入身分證號 → 自動帶出之前填過的資料，只需簽名！|

### 📊 會計師匯出資料

Excel 匯出包含：
- 領款人基本資料（姓名、身分證字號、戶籍地址）
- 所得類別與金額明細
- 代扣所得稅金額
- 二代健保補充保費金額
- 銀行匯款資訊（銀行、分行、帳號）
- 簽名日期

---

## 💰 2025 年扣繳規則

### 所得稅代扣

| 所得類別 | 說明 | 起扣點 | 稅率 |
|---------|------|-------|-----|
| 50 兼職所得 | 兼職薪資、臨時工資 | ≥ 88,501 元 | 5% |
| 9A 執行業務 | 講師費、顧問費、設計費 | ≥ 20,010 元 | 10% |
| 9B 稿費 | 稿費、版稅、演講鐘點費 | ≥ 20,010 元 | 10% |
| 92 其他所得 | 競賽獎金、其他勞務 | 免扣繳 | - |

### 二代健保補充保費

| 所得類別 | 起扣點 | 費率 |
|---------|-------|-----|
| 50 兼職所得 | ≥ 28,590 元（基本工資）| 2.11% |
| 9A 執行業務 | ≥ 20,000 元 | 2.11% |
| 9B 稿費 | ≥ 20,000 元 | 2.11% |
| 92 其他所得 | ≥ 20,000 元 | 2.11% |

> 💡 **工會成員免扣**：若領款人有加入職業工會，可免扣二代健保補充保費

---

## 🔄 使用流程

```
┌─────────────────────────────────────────────────────────────┐
│                        後台操作                              │
├─────────────────────────────────────────────────────────────┤
│  1. 選擇公司（智慧媽咪 / 薇佳工作室）                          │
│                         ↓                                   │
│  2. 新增勞報單 → 填寫金額、所得類別、支付日期                   │
│                         ↓                                   │
│  3. 系統自動計算 → 代扣所得稅、二代健保                        │
│                         ↓                                   │
│  4. 產生簽名連結 → 複製發送給領款人（LINE、Email）              │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                     領款人操作（免登入）                       │
├─────────────────────────────────────────────────────────────┤
│  5. 開啟連結 → 查看勞報單資訊                                 │
│                         ↓                                   │
│  【第一次】填寫完整資料 + 上傳證件 + 簽名                       │
│  【第二次起】自動帶出舊資料 → 確認後直接簽名！                   │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                      會計師匯出                              │
├─────────────────────────────────────────────────────────────┤
│  6. 後台勾選已簽名的勞報單                                    │
│                         ↓                                   │
│  7. 批次匯出 Excel → 交給會計師報稅                           │
└─────────────────────────────────────────────────────────────┘
```

---

## 🛠️ 技術架構

| 項目 | 技術 |
|-----|------|
| 前端框架 | Next.js 14 (App Router) |
| 程式語言 | TypeScript |
| 樣式 | Tailwind CSS |
| 後端/資料庫 | Supabase (PostgreSQL) |
| 認證 | Supabase Auth (Google OAuth) |
| 檔案儲存 | Supabase Storage |
| 部署 | Vercel |

---

## 📁 專案結構

```
labor-report/
├── app/
│   ├── (dashboard)/              # 後台管理頁面（需登入）
│   │   ├── layout.tsx            # 後台 Layout（含公司切換）
│   │   ├── reports/              # 勞報單管理
│   │   │   ├── page.tsx          # 列表頁（含批次匯出）
│   │   │   ├── new/page.tsx      # 新增頁
│   │   │   └── [id]/page.tsx     # 詳情頁（含下載）
│   │   └── contacts/             # 聯絡人管理
│   │       └── page.tsx
│   ├── sign/
│   │   └── [token]/page.tsx      # 外部簽名頁（免登入）⭐
│   ├── globals.css
│   ├── layout.tsx
│   └── page.tsx
├── lib/
│   ├── calculations.ts           # 扣繳計算邏輯（2025年版）
│   └── supabase/
│       └── client.ts             # Supabase 客戶端
├── supabase/
│   └── schema.sql                # 資料庫結構
├── package.json
├── tailwind.config.js
└── tsconfig.json
```

---

## 🚀 部署步驟

### 1. Supabase 設定（沿用現有專案）

你已經有 Supabase 專案和 Google OAuth：
- **Project URL**: `https://lexcvcinmphkmavgswgn.supabase.co`
- **Google OAuth**: 已設定完成 ✅

#### 1.1 執行資料庫 Schema（加入勞報單資料表）
1. 進入 Supabase Dashboard → SQL Editor
2. 貼上 `supabase/schema.sql` 內容並執行

#### 1.2 建立 Storage Bucket（存證件照片）
1. 進入 Storage → New Bucket
2. 建立名為 `attachments` 的 bucket
3. 設定為 Private

### 2. 本地開發

```bash
# 複製專案
git clone <your-repo>
cd labor-report

# 安裝依賴
npm install

# 設定環境變數
cp .env.example .env.local
# 編輯 .env.local 填入 Supabase 連線資訊

# 啟動開發伺服器
npm run dev
```

### 3. 環境變數

```env
# .env.local
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 4. Vercel 部署

1. 將專案推送到 GitHub
2. 前往 [vercel.com](https://vercel.com) 連接 GitHub repo
3. 設定環境變數（同上）
4. 部署完成！

---

## 📱 畫面預覽

### 後台 - 勞報單列表
- 顯示所有勞報單
- 狀態篩選（草稿/待簽名/已簽名）
- 勾選批次匯出 Excel

### 後台 - 新增勞報單
- 填寫金額即時計算扣繳
- 一鍵產生簽名連結

### 外部簽名頁
- 領款人免登入開啟
- 上傳證件（支援手機拍照）
- 手寫簽名板
- 舊資料自動帶出

---

## ❓ 常見問題

### Q: 領款人需要註冊帳號嗎？
A: 不用！領款人只需開啟連結即可填寫資料和簽名。

### Q: 資料會自動儲存嗎？
A: 會！領款人第一次填寫後，下次只需輸入身分證號，系統會自動帶出之前的資料，只需簽名即可。

### Q: 證件照片安全嗎？
A: 證件照片儲存在 Supabase Storage，僅授權用戶可存取，不會外洩。

### Q: 可以處理兩家公司的勞報單嗎？
A: 可以！後台左上角可切換公司，每家公司的資料分開管理。

### Q: 匯出的 Excel 包含什麼？
A: 包含領款人完整資料、所得明細、代扣稅額、銀行資訊、簽名日期，可直接交給會計師報稅。

### Q: 工會成員怎麼處理？
A: 領款人在簽名頁可勾選「我有加入職業工會」，系統會自動免扣二代健保。

---

## 📞 技術支援

如有問題，請聯繫開發團隊。

---

## 📄 授權

© 2025 智慧媽咪國際股份有限公司 / 薇佳工作室

Mommy Wisdom International Co. / Weijia Studio
